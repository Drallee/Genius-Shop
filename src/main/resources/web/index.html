<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Genius Shop - Configuration Editor</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Mobile Menu Backdrop -->
    <div id="mobile-menu-backdrop" class="mobile-menu-backdrop" onclick="toggleMobileMenu()"></div>

    <!-- Mobile Dropdown Menu -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="mobile-menu-content">
            <label class="toggle-switch mobile-toggle">
                <input type="checkbox" id="auto-save-toggle-mobile" checked>
                <span class="toggle-label">Auto-save</span>
            </label>
            <label class="toggle-switch mobile-toggle">
                <input type="checkbox" id="animations-toggle-mobile" checked>
                <span class="toggle-label">Animations</span>
            </label>
            <button onclick="openActivityLogModal(); toggleMobileMenu();" class="mobile-menu-item">
                <span class="btn-icon">üìã</span>
                <span>History</span>
            </button>
            <button onclick="reloadCurrentConfig(); toggleMobileMenu();" class="mobile-menu-item">
                <span class="btn-icon">üîÑ</span>
                <span>Reload from Server</span>
            </button>
            <button onclick="manualSave(); toggleMobileMenu();" class="mobile-menu-item btn-primary">
                <span class="btn-icon">üíæ</span>
                <span>Save Current Tab</span>
            </button>
            <button onclick="publishChanges(); toggleMobileMenu();" class="mobile-menu-item" style="background: linear-gradient(135deg, rgba(0, 230, 118, 0.2), rgba(0, 200, 100, 0.2)); border-color: rgba(0, 230, 118, 0.4);">
                <span class="btn-icon">üöÄ</span>
                <span>Publish All Changes</span>
            </button>
            <button onclick="logout();" class="mobile-menu-item btn-danger">
                <span class="btn-icon">üö™</span>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="header-top flex justify-between items-center mb-20">
                <div id="user-info"></div>

                <!-- Hamburger Menu Button (Mobile Only) -->
                <button id="mobile-menu-toggle" class="mobile-menu-btn" onclick="toggleMobileMenu()">
                    <span class="hamburger-icon"></span>
                </button>

                <div id="desktop-nav" class="desktop-navigation flex gap-12 items-center">
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-save-toggle" checked>
                        <span class="toggle-label">Auto-save</span>
                    </label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="animations-toggle" checked>
                        <span class="toggle-label">Animations</span>
                    </label>
                    <button onclick="openActivityLogModal()" class="header-btn btn-activity">
                        <span class="btn-icon">üìã</span>
                        <span>HISTORY</span>
                    </button>
                    <button onclick="reloadCurrentConfig()" class="header-btn btn-secondary">
                        <span class="btn-icon">üîÑ</span>
                        <span>RELOAD</span>
                    </button>
                    <button onclick="manualSave()" class="header-btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        <span>SAVE TAB</span>
                    </button>
                    <button onclick="publishChanges()" class="header-btn btn-publish">
                        <span class="btn-icon">üöÄ</span>
                        <span>PUBLISH ALL</span>
                    </button>
                    <button onclick="logout()" class="header-btn btn-danger">
                        <span class="btn-icon">üö™</span>
                        <span>LOGOUT</span>
                    </button>
                </div>
            </div>

            <div class="header-hero">
                <h1>‚õèÔ∏è GENIUS SHOP EDITOR</h1>
                <p>Configure your shop with live Minecraft preview</p>
                <div class="beta-badge">
                    ‚ö†Ô∏è BETA - Some features may be working and some might be missing
                </div>
                <div>
                    <a href="https://github.com/Drallee/Genius-Shop/issues" target="_blank" class="bug-report-link">
                        üêõ Report bugs or missing features
                    </a>
                </div>
                <div id="save-status" class="save-status-indicator"></div>
            </div>
        </header>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('mainmenu')">MAIN MENU</button>
                <button class="tab" onclick="switchTab('shop')">SHOP</button>
                <button class="tab" onclick="switchTab('purchase')">PURCHASE</button>
                <button class="tab" onclick="switchTab('sell')">SELL</button>
                <button class="tab" onclick="switchTab('guisettings')">GUI SETTINGS</button>
            </div>
        </div>

        <div class="main-content">
            <!-- Unified Editor & Preview Panel -->
            <div class="preview-panel unified-panel">
                
                <!-- Live Preview (Shared at top) -->
                <div class="minecraft-preview-section">
                    <div class="minecraft-gui" id="preview">
                        <div class="gui-title" id="preview-title">Loading...</div>
                        <div class="gui-grid" id="preview-grid"></div>
                    </div>
                    
                    <!-- Page Navigation (Shop only) -->
                    <div id="page-navigation" class="pagination">
                        <button onclick="changePage(-1)" class="btn page-btn">
                            <span style="font-size: 1.1em;">‚óÄ</span> PREV
                        </button>
                        <span id="page-indicator" class="page-indicator">Page 1/1</span>
                        <button onclick="changePage(1)" class="btn page-btn">
                            NEXT <span style="font-size: 1.1em;">‚ñ∂</span>
                        </button>
                    </div>
                </div>

                <!-- MAIN MENU TAB -->
                <div id="mainmenu-tab" class="tab-content active">
                    <div class="content-header flex justify-between items-center mb-30">
                        <div class="flex items-center gap-12">
                            <div class="icon-badge primary"><span style="font-size: 1.1em; color: white;">üè†</span></div>
                            <span class="header-title">MAIN MENU EDITOR</span>
                            <div id="mainmenu-buttons-count" class="count-badge">0 buttons</div>
                        </div>
                        <div class="flex gap-12">
                            <button class="btn btn-secondary action-btn" onclick="openMainMenuSettings()" style="height: 54px; border-radius: 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0 25px;">
                                <span style="font-size: 1.2em; margin-right: 8px;">‚öôÔ∏è</span>
                                <span style="font-weight: 700; letter-spacing: 1px;">SETTINGS</span>
                            </button>
                            <button class="btn btn-primary action-btn" onclick="addMainMenuShop()" style="height: 54px; padding: 0 25px; border-radius: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border: none; box-shadow: 0 4px 15px rgba(120, 119, 198, 0.3);">
                                <span style="font-size: 1.2em; margin-right: 8px;">‚ûï</span>
                                <span style="font-weight: 700; letter-spacing: 0.5px;">ADD BUTTON</span>
                            </button>
                        </div>
                    </div>
                    <div id="mainmenu-shops-container" class="grid-list"></div>
                </div>

                <!-- SHOP TAB -->
                <div id="shop-tab" class="tab-content">
                    <div class="shop-file-bar flex items-center gap-20 mb-20 p-20" style="background: rgba(255,255,255,0.02); border-radius: 20px; border: 1px solid var(--border);">
                        <div class="flex items-center gap-12 flex-1">
                            <span style="font-size: 1.5em;">üìÅ</span>
                            <div class="flex-1">
                                <label class="section-label" style="margin-bottom: 4px; display: block; font-size: 0.7em;">CURRENT SHOP FILE</label>
                                <select id="shop-selector" onchange="switchShop(this.value)" class="premium-select w-full">
                                    <option value="">Loading shops...</option>
                                </select>
                            </div>
                            <button class="btn btn-danger icon-btn" onclick="removeShopFile()" title="Delete Shop File" style="margin-top: 18px; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 12px;">
                                <span style="font-size: 1.2em;">üóëÔ∏è</span>
                            </button>
                        </div>
                        <button class="btn btn-success action-btn" onclick="createNewShop()" style="height: 54px; padding: 0 25px; border-radius: 14px; margin-top: 18px;">
                            <span style="font-size: 1.2em; margin-right: 8px;">üìÑ</span>
                            <span style="font-weight: 700; letter-spacing: 0.5px;">CREATE NEW SHOP</span>
                        </button>
                    </div>

                    <div class="content-header flex justify-between items-center mb-24">
                        <div class="flex items-center gap-12">
                            <div class="icon-badge primary">‚úèÔ∏è</div>
                            <span class="header-title">SHOP CONTENT</span>
                            <div id="items-count-display" class="count-badge">0 items</div>
                        </div>
                        
                        <div class="flex gap-12 items-center">
                            <!-- Search Bar -->
                            <div class="search-wrapper">
                                <span class="search-icon">üîç</span>
                                <input type="text" id="item-search" placeholder="Search by name or material..." oninput="handleItemSearch()">
                            </div>
                            
                            <button class="btn btn-secondary action-btn" onclick="openShopSettings()" style="height: 54px; width: 54px; padding: 0; border-radius: 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center;" title="Shop Settings">
                                <span style="font-size: 1.4em;">‚öôÔ∏è</span>
                            </button>
                            <button class="btn btn-primary action-btn" onclick="addItem()" style="height: 54px; padding: 0 25px; border-radius: 14px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border: none; box-shadow: 0 4px 15px rgba(120, 119, 198, 0.3);">
                                <span style="font-size: 1.2em; margin-right: 8px;">‚ûï</span>
                                <span style="font-weight: 700; letter-spacing: 0.5px;">ADD ITEM</span>
                            </button>
                        </div>
                    </div>
                    <div id="items-container" class="grid-list"></div>
                </div>

                <!-- PURCHASE TAB -->
                <div id="purchase-tab" class="tab-content">
                    <div class="content-header flex justify-between items-center mb-24">
                        <div class="flex items-center gap-12">
                            <div class="icon-badge warning"><span style="font-size: 1.1em; color: white;">üí∞</span></div>
                            <span class="header-title">PURCHASE CONFIGURATION</span>
                        </div>
                        <button class="btn btn-secondary action-btn" onclick="openPurchaseSettings()" style="height: 54px; border-radius: 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0 25px;">
                            <span style="font-size: 1.2em; margin-right: 8px;">‚öôÔ∏è</span>
                            <span style="font-weight: 700; letter-spacing: 1px;">MENU SETTINGS</span>
                        </button>
                    </div>
                    <div id="purchase-buttons-list" class="flex-list"></div>
                </div>

                <!-- SELL TAB -->
                <div id="sell-tab" class="tab-content">
                    <div class="content-header flex justify-between items-center mb-24">
                        <div class="flex items-center gap-12">
                            <div class="icon-badge success"><span style="font-size: 1.1em; color: white;">üíµ</span></div>
                            <span class="header-title">SELL CONFIGURATION</span>
                        </div>
                        <button class="btn btn-secondary action-btn" onclick="openSellSettings()" style="height: 54px; border-radius: 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 0 25px;">
                            <span style="font-size: 1.2em; margin-right: 8px;">‚öôÔ∏è</span>
                            <span style="font-weight: 700; letter-spacing: 1px;">MENU SETTINGS</span>
                        </button>
                    </div>
                    <div id="sell-buttons-list" class="flex-list"></div>
                </div>

                <!-- GUI SETTINGS TAB -->
                <div id="guisettings-tab" class="tab-content">
                    <div class="content-header flex justify-between items-center mb-24">
                        <div class="flex items-center gap-12">
                            <div class="icon-badge primary"><span style="font-size: 1.1em; color: white;">üé®</span></div>
                            <span class="header-title">GUI GLOBAL SETTINGS</span>
                        </div>
                        <button class="btn btn-primary action-btn" onclick="saveGuiSettingsYaml()" style="height: 54px; padding: 0 25px; border-radius: 14px;">
                            <span style="font-size: 1.2em; margin-right: 8px;">üíæ</span>
                            <span style="font-weight: 700; letter-spacing: 0.5px;">SAVE GUI SETTINGS</span>
                        </button>
                    </div>
                    <div id="gui-settings-container" class="settings-grid">
                        <!-- GUI settings will be rendered here -->
                    </div>
                </div>

                <!-- Hidden state store -->
                <div style="display: none;">
                    <pre id="export-output"></pre>
                    <span id="mainmenu-title-display"></span>
                    <span id="mainmenu-rows-display"></span>
                </div>

                <div class="info-box" style="margin-top: 40px;">
                    <div class="flex justify-between items-center mb-12 cursor-pointer" onclick="toggleQuickTips()">
                        <h3 class="flex items-center gap-8 m-0">
                            <span style="font-size: 1.2em;">üí°</span>
                            <span style="font-size: 0.9em; font-weight: 700; letter-spacing: 0.5px;">QUICK TIPS</span>
                        </h3>
                        <span id="tips-toggle-icon" class="toggle-icon" style="font-size: 0.8em; color: rgba(200, 210, 225, 0.7);">‚ñº</span>
                    </div>
                    <ul id="quick-tips-list" style="display: block;">
                        <li>‚ú® Click items in preview to edit properties</li>
                        <li>üé® Real Minecraft textures displayed</li>
                        <li>üíæ Auto-save keeps your changes safe</li>
                        <li>üîÑ Use SYNC to reload from server</li>
                        <li>üìÑ Create multiple shop files</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Minecraft-style tooltip -->
    <div class="minecraft-tooltip" id="minecraft-tooltip"></div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Edit Item</h2>
                <button onclick="closeEditModal()" class="modal-close">‚úï</button>
            </div>
            <div id="modal-content">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button id="modal-delete-btn" onclick="deleteFromModal()" class="btn-base btn-danger" style="display: none;">üóëÔ∏è Delete</button>
                <div class="flex gap-12">
                    <button onclick="closeEditModal()" class="btn-base btn-secondary">Cancel</button>
                    <button onclick="saveEditModal()" class="btn-base btn-success">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Log Modal -->
    <div id="activity-log-modal" class="modal-overlay">
        <div class="modal-box" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 class="modal-title">üìã HISTORY LOG</h2>
                <button onclick="closeActivityLogModal()" class="modal-close">‚úï</button>
            </div>

            <div class="flex gap-12 mb-20">
                <button class="btn-base btn-primary flex-1" onclick="refreshActivityLog()">
                    <span>üîÑ REFRESH</span>
                </button>
                <button class="btn-base btn-danger flex-1" onclick="clearActivityLog()">
                    <span>üóëÔ∏è CLEAR ALL</span>
                </button>
            </div>

            <div class="info-box mb-20">
                <div class="flex items-center gap-8 mb-8">
                    <span>‚ÑπÔ∏è</span>
                    <h3 class="m-0">ABOUT HISTORY LOG</h3>
                </div>
                <p class="text-muted" style="font-size: 0.85rem; margin: 0;">
                    Track all changes made by users. Click any entry to view detailed before/after comparison.
                </p>
            </div>

            <div id="activity-log-container" class="scroll-y" style="max-height: 500px; display: flex; flex-direction: column; gap: 0.75rem;">
                <!-- Activity entries will be inserted here -->
            </div>

            <div id="activity-log-empty" class="text-center" style="padding: 4rem 0;">
                <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.2;">üìã</div>
                <div style="font-size: 1.1rem; font-weight: 600; color: var(--text-muted);">No Activity Yet</div>
            </div>
        </div>
    </div>

    <!-- Universal Alert Modal -->
    <div id="alert-modal" class="modal-overlay" style="z-index: 10003;">
        <div class="modal-box" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="alert-modal-title" class="modal-title flex items-center gap-12">
                    <span id="alert-modal-icon">‚ÑπÔ∏è</span>
                    <span id="alert-modal-title-text">Message</span>
                </h2>
            </div>
            <div id="alert-modal-content" class="mb-24" style="line-height: 1.6; white-space: pre-wrap;">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button onclick="closeAlertModal()" class="btn-base btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Universal Confirm Modal -->
    <div id="confirm-modal" class="modal-overlay" style="z-index: 10003;">
        <div class="modal-box" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title flex items-center gap-12">
                    <span>‚ö†Ô∏è</span>
                    <span>Confirm Action</span>
                </h2>
            </div>
            <div id="confirm-modal-content" class="mb-24" style="line-height: 1.6; white-space: pre-wrap;">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="modal-footer">
                <button onclick="closeConfirmModal(false)" class="btn-base btn-secondary">Cancel</button>
                <button onclick="closeConfirmModal(true)" class="btn-base btn-warning">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Prompt Modal -->
    <div id="prompt-modal" class="modal-overlay" style="z-index: 10003;">
        <div class="modal-box" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="prompt-modal-title" class="modal-title flex items-center gap-12">
                    <span id="prompt-modal-icon">‚úèÔ∏è</span>
                    <span id="prompt-modal-title-text">Enter Value</span>
                </h2>
            </div>
            <div id="prompt-modal-content" class="mb-16">
                <!-- Content will be dynamically inserted here -->
            </div>
            <div class="mb-24">
                <input type="text" id="prompt-modal-input" class="input-base" placeholder="Enter value...">
            </div>
            <div class="modal-footer">
                <button onclick="closePromptModal(null)" class="btn-base btn-secondary">Cancel</button>
                <button onclick="submitPromptModal()" class="btn-base btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Save Confirmation Modal -->
    <div id="save-confirmation-modal" class="modal-overlay" style="z-index: 10002;">
        <div class="modal-box">
            <div class="modal-header">
                <h2 class="modal-title flex items-center gap-12">
                    <span>üíæ</span>
                    <span>Confirm Save</span>
                </h2>
                <button onclick="closeSaveConfirmationModal()" class="modal-close">‚úï</button>
            </div>

            <div id="save-confirmation-content">
                <!-- Content will be dynamically inserted here -->
            </div>

            <div class="modal-footer">
                <button onclick="closeSaveConfirmationModal()" class="btn-base btn-secondary">Cancel</button>
                <button onclick="confirmSave()" class="btn-base btn-success">
                    <span>üíæ SAVE CURRENT TAB</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Activity Detail Modal -->
    <div id="activity-detail-modal" class="modal-overlay" style="z-index: 10001;">
        <div class="modal-box" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title flex items-center gap-12">
                    <span>üìã</span>
                    <span id="activity-detail-title">Change Details</span>
                </h2>
                <button onclick="closeActivityDetailModal()" class="modal-close">‚úï</button>
            </div>
            <div id="activity-detail-content">
                <!-- Diff content will be dynamically inserted here -->
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button id="rollback-btn" onclick="rollbackChange()" class="btn-base btn-warning" style="display: none;">
                    <span>‚èÆÔ∏è ROLLBACK</span>
                </button>
                <button onclick="closeActivityDetailModal()" class="btn-base btn-secondary">Close</button>
            </div>
        </div>
    </div>
    <footer style="margin-top: 40px; padding: 30px 0 25px 0; text-align: center; border-top: 1px solid rgba(120, 119, 198, 0.15); position: relative; z-index: 10;">
        <div style="max-width: 600px; margin: 0 auto;">
            <div style="font-size: 0.85em; color: rgba(150, 160, 180, 0.6); line-height: 1.8;">
                <p style="margin: 0 0 12px 0;">A powerful configuration editor for Minecraft shop plugins with live preview</p>
            </div>

            <div style="display: flex; gap: 16px; justify-content: center; align-items: center; margin: 16px 0; flex-wrap: wrap;">
                <a href="https://github.com/Drallee/Genius-Shop" target="_blank" style="color: rgba(120, 119, 198, 0.8); text-decoration: none; display: inline-flex; align-items: center; gap: 5px; font-size: 0.85em; transition: color 0.3s ease; position: relative; z-index: 11;" onmouseover="this.style.color='rgba(120, 119, 198, 1)';" onmouseout="this.style.color='rgba(120, 119, 198, 0.8)';">
                    ‚≠ê Star on GitHub
                </a>
                <span style="color: rgba(120, 119, 198, 0.3);">‚Ä¢</span>
                <a href="https://github.com/Drallee/Genius-Shop/issues" target="_blank" style="color: rgba(120, 119, 198, 0.8); text-decoration: none; display: inline-flex; align-items: center; gap: 5px; font-size: 0.85em; transition: color 0.3s ease; position: relative; z-index: 11;" onmouseover="this.style.color='rgba(120, 119, 198, 1)';" onmouseout="this.style.color='rgba(120, 119, 198, 0.8)';">
                    üêõ Report Issues
                </a>
            </div>

            <div style="margin-top: 16px; font-size: 0.8em; color: rgba(130, 140, 160, 0.5);">
                <p style="margin: 0;">Made with ‚ù§Ô∏è by Dralle for the Minecraft community</p>
                <p style="margin: 6px 0 0 0;">¬© 2025 Genius Shop - Open Source Project</p>
            </div>
        </div>
    </footer>
    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="js/core.js"></script>
    <script src="js/database.js"></script>
    <script src="js/modals.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/events.js"></script>
</body>
</html>
